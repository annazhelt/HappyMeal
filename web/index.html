<html>
<head>
    <script src="/js/jquery.js"></script>
    <link rel="stylesheet" href="/css/bootstrap.css"/>
    <title>Hello World</title>
</head>
<body>

    <form class="form-inline">
        <div class="form-group">
            <label for="columnName">Display</label>
            <select id="columnName" class="form-control">
                <option value="name">Name</option>
                <option value="price">Price</option>
            </select>
        </div>
        <div class="form-group">
            <label for="priceThreshold">for Dishes whose price is greater than?</label>
            <input type="number" class="form-control" id="priceThreshold" >
        </div>

        <table id="resultTable" class="table-bordered">

        </table>
        <button type="button" class="btn btn-default" onclick="showResult()">Show Result</button>
        <button type="button" class="btn btn-default" onclick="clearResult()">Clear Result</button>

    </form>
    <div>
        <button type="button" class="btn btn-default" id = "showRestaurant" onclick="showRestaurants()">Show Restaurants</button>
    </div>
    <div id="somediv"> </div>


<script>

    function clearResult() {
        $("#resultTable").html("");
    }

        function showRestaurants(){
            $.ajax({
                type: "GET",
                url: "/showRestaurants",
                success: function(response) {
                    resNames = response.split(",")
                    for (var i = 0; i<resNames.length ; i++) {
                        $("#somediv").append("<p id=\""+resNames[i]+"\">" + resNames[i] +
                                "<button type=\"button\" id = \"" + resNames[i] +"\" onclick=\"showComment()\"> Show Comments</button></p>");
                    }
                    $("#showRestaurant").attr('disabled', true);
                }
            });
        }

    function showComment() {
        var e = window.event,
                btn = e.target || e.srcElement;
        //alert(btn.id);
        var rname = btn.id;
        $.ajax({
            method: "POST",
            url: "/showRestaurants",
            data: {
                resName: rname
            },
            success: function(response){
                comments = response.split("/")
                //alert(response)
                for (var i = 0; i<comments.length ; i++){
                    var parent = btn.parentElement
                    $(parent).append("<p>"+comments[i]+"</p>");
                }
            }

        });

    }


    function showResult() {
        clearResult();
        var columnName = $("#columnName").val();
        var priceThreshold = $("#priceThreshold").val();
        $.ajax({
            method: "POST",
            url: "DishController.jsp",
            data: {
                columnName : columnName,
                priceThreshold : priceThreshold
            }
        })
            .done(function(msg) {
                var resultValue = JSON.parse(msg);
                var columnName = $("#columnName").val();
                var headerRow = $("<tr/>");
                var headerColumn = $("<th/>").html(columnName).appendTo(headerRow);
                $("#resultTable").append(headerRow);

                var resultRow;
                var resultColumn;
                for (var i = 0; i < resultValue.length; i++) {
                    var result = resultValue[i];
                    var value = result[columnName];

                    resultRow = $("<tr/>");
                    resultColumn = $("<td/>").html(value).appendTo(resultRow);
                    $("#resultTable").append(resultRow);
                }
            });

    }
</script>
</body>
</html>
