<html>
<head>
    <script src="/js/jquery.js"></script>
    <link rel="stylesheet" href="/css/bootstrap.css"/>
    <title>Hello World</title>
</head>
<body>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h3 class="panel-title">Find dishes</h3>
        </div>
        <div class="panel-body">
            <form class="form-inline">
                <div class="form-group">
                    <label for="columnName">Display name and </label>
                    <select id="columnName" class="form-control">
                        <option value="restaurant">Restaurant</option>
                        <option value="price">Price</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="priceThreshold">for Dishes whose price is greater than </label>
                    <input type="number" min="0" class="form-control" id="priceThreshold" >
                </div>
                <br>
                <p></p>
                <div>

                    <table id="resultTable" class="table">

                    </table>
                </div>
                <button type="button" class="btn btn-primary" onclick="showResult()">Show Result</button>
                <button type="button" class="btn btn-default" onclick="clearResult()">Clear Result</button>

            </form>
        </div>
    </div>

    <div class="panel panel-success">
        <div class="panel-heading">
            <h3 class="panel-title">Find the most/leat expensive dish(es)</h3>
        </div>
        <div class="panel-body">
            <form class="form-inline">
                <div class="form-group">
                    <label for="aggregation">Display the </label>
                    <select id="aggregation" class="form-control">
                        <option value="max">most</option>
                        <option value="min">least</option>
                    </select>
                    <label for="aggregation">expensive dish </label>
                </div>
                <br>
                <p></p>
                <div>
                    <table id="aggregationResult" class="table">
                    </table>
                </div>
                <button type="button" class="btn btn-success" onclick="showAggregationResult()">Show Result</button>
                <button type="button" class="btn btn-default" onclick="clearAggregationResult()">Clear Result</button>

            </form>
        </div>
    </div>

    <div>
        <button type="button" class="btn btn-default" id = "showRestaurant" onclick="showRestaurants()">Show Restaurants</button>
    </div>
    <div id="somediv"> </div>


<script>

    function showRestaurants(){

            if ($("#showRestaurant").hasClass("down")){
                $("#somediv").html("");
            } else {
                $.ajax({
                    type: "GET",
                    url: "/showRestaurants",
                    success: function (response) {
                        resNames = response.split(",")
                        for (var i = 0; i < resNames.length; i++) {
                            $("#somediv").append("<p>" + resNames[i] +
                                    "<button type='button' id = '"
                                    + resNames[i] + "' onclick='showComment()'> Show Comments</button> " +
                                    "<button id = '"+resNames[i]+"a' onclick='addComment()'>Add Comment </button> <div id = '"+
                                    resNames[i]+"c'></div></div></p>");
                        }
                    }
                })
            }
            $("#showRestaurant").toggleClass("down")
    }

    function addComment() {
        var e = window.event,
                btn = e.target || e.srcElement;
        var rnamec = btn.id;
        if ($(btn).hasClass("down")){

        }else {
            $(btn).addClass("down")
            rname = rnamec.substr(0, rnamec.length-1)
            //alert(rname);
            elem = document.getElementById(rname+"c");
            //alert(elem.id)
            $(elem).append("<form method='post'> NAME: <input type='text' name='name' id='name' /><br />" +
                    "Comment:<br />" +
                    "<textarea name='comment' id='comment'></textarea><br />" +
                    "<input type='hidden' name='articleid' id='articleid' value='<? echo $_GET[\"id\"]; ?>' /> " +
                    "<input type='submit' value='Submit' /> + </form>")
        }
    }

    function showComment() {
        var e = window.event,
                btn = e.target || e.srcElement;
        //alert(btn.id);
        var rname = btn.id;
        if ($(btn).hasClass("down")){
            var elem = document.getElementById(rname+"c");
            $(elem).html("");
        } else {
            $.ajax({
                method: "GET",
                url: "/showComments",
                data: {
                    resName: rname
                },
                success: function (response) {
                    comments = response.split("/")
                    var elem = document.getElementById(rname + "c");
                    for (var i = 0; i < comments.length; i++) {
                        $(elem).append("<p>" + comments[i] + "</p>");
                    }
                }

            });
        }
        $(btn).toggleClass("down")
    }

    //requirement 3
    function clearAggregationResult() {
        $("#aggregationResult").html("");
    }
    function showAggregationResult() {
        clearAggregationResult();
        var aggregation = $("#aggregation").val(); // values "max" "min"
        $.ajax({
            method: "POST",
            url: "MaxMinDishController.jsp",
            data: {
                aggregation : aggregation
            }
        })
            .done(function(msg) {
                var resultValue = JSON.parse(msg);
                var headerRow = $("<tr/>");
                var headerColumnForDishName = $("<th/>").html("dish name").appendTo(headerRow);
                var headerColumnForPrice = $("<th/>").html("price").appendTo(headerRow);
                $("#aggregationResult").append(headerRow);

                var resultRow;
                var dishNameColumn;
                var priceColumn;
                for (var i = 0; i < resultValue.length; i++) {
                    var result = resultValue[i];
                    var dishName = result["dishName"];
                    var price = result["price"];

                    resultRow = $("<tr/>");
                    dishNameColumn = $("<td/>").html(dishName).appendTo(resultRow)
                    priceColumn = $("<td/>").html(price).appendTo(resultRow);
                    $("#aggregationResult").append(resultRow);
                }
            });

    }

    //requirement 1
    function clearResult() {
        $("#resultTable").html("");
    }
    function showResult() {
        clearResult();
        var columnName = $("#columnName").val();
        var priceThreshold = $("#priceThreshold").val();
        $.ajax({
                    method: "POST",
                    url: "DishController.jsp",
                    data: {
                        columnName : columnName,
                        priceThreshold : priceThreshold
                    }
                })
                .done(function(msg) {
                    var resultValue = JSON.parse(msg);
                    var columnName = $("#columnName").val();
                    var headerRow = $("<tr/>");
                    var headerColumnForDishName = $("<th/>").html("dish name").appendTo(headerRow);
                    var headerColumnForOthers = $("<th/>").html(columnName).appendTo(headerRow);
                    $("#resultTable").append(headerRow);

                    var resultRow;
                    var dishNameColumn;
                    var resultColumn;
                    for (var i = 0; i < resultValue.length; i++) {
                        var result = resultValue[i];
                        var dishName = result["dishName"];
                        var value = result[columnName];

                        resultRow = $("<tr/>");
                        dishNameColumn = $("<td/>").html(dishName).appendTo(resultRow)
                        resultColumn = $("<td/>").html(value).appendTo(resultRow);
                        $("#resultTable").append(resultRow);
                    }
                });

    }
</script>
</body>
</html>
